# Development Guide

## Quick Start

### Running the App

```bash
# Install dependencies
flutter pub get

# Generate database code
dart run build_runner build --delete-conflicting-outputs

# Generate localization
flutter gen-l10n

# Run on connected device
flutter run

# Run on specific device
flutter devices  # List available devices
flutter run -d <device-id>
```

### Development Commands

```bash
# Analyze code
flutter analyze

# Format code
dart format lib/

# Clean build
flutter clean

# Check for outdated packages
flutter pub outdated

# Run tests (when implemented)
flutter test
```

## Project Structure

```
lib/
├── data/
│   ├── database/
│   │   ├── database.dart          # Main database class
│   │   ├── database.g.dart        # Generated by drift
│   │   └── tables.dart            # Table definitions
│   └── services/
│       ├── biometric_service.dart # Biometric authentication
│       ├── currency_service.dart  # Currency API integration
│       └── notification_service.dart # Local notifications
├── providers/
│   ├── category_provider.dart     # Category state management
│   ├── currency_provider.dart     # Currency state management
│   ├── statistics_provider.dart   # Statistics calculations
│   └── transaction_provider.dart  # Transaction state management
├── screens/
│   ├── auth_screen.dart           # Biometric auth screen
│   ├── categories_screen.dart     # Categories list
│   ├── category_form_screen.dart  # Add/edit category
│   ├── home_screen.dart           # Main navigation
│   ├── settings_screen.dart       # App settings
│   ├── statistics_screen.dart     # Charts and stats
│   ├── transactions_screen.dart   # Transaction list
│   └── transaction_form_screen.dart # Add/edit transaction
├── l10n/
│   ├── app_en.arb                 # English translations
│   ├── app_pl.arb                 # Polish translations
│   └── app_localizations.dart     # Generated
└── main.dart                      # App entry point
```

## Key Features Implementation

### 1. Database (Drift)

The app uses Drift as an ORM for SQLite:

- **Tables**: Defined in `tables.dart`
- **Queries**: Implemented in `database.dart`
- **Code Generation**: Run `dart run build_runner build` after schema changes

**Example: Adding a new table**

```dart
// In tables.dart
class MyNewTable extends Table {
  IntColumn get id => integer().autoIncrement()();
  TextColumn get name => text()();
}

// Then regenerate
// dart run build_runner build --delete-conflicting-outputs
```

### 2. State Management (Provider)

All state is managed through Provider:

- **TransactionProvider**: CRUD for transactions
- **CategoryProvider**: CRUD for categories
- **StatisticsProvider**: Calculations and aggregations
- **CurrencyProvider**: Currency rates and conversion

**Example: Using a provider**

```dart
// Read value
final provider = context.read<TransactionProvider>();

// Watch for changes
Consumer<TransactionProvider>(
  builder: (context, provider, child) {
    return Text('${provider.transactions.length}');
  },
);
```

### 3. Localization

Translations are managed via ARB files:

- `app_en.arb`: English
- `app_pl.arb`: Polish

**Adding a new string:**

1. Add to both ARB files:
```json
{
  "myNewString": "My Text",
  ...
}
```

2. Regenerate:
```bash
flutter gen-l10n
```

3. Use in code:
```dart
final l10n = AppLocalizations.of(context)!;
Text(l10n.myNewString)
```

### 4. API Integration

Currency rates are fetched from Exchange Rate API:

- **Service**: `currency_service.dart`
- **Provider**: `currency_provider.dart`
- **Caching**: Rates stored in `CurrencyRates` table

**Example: Fetching rates**

```dart
final currencyProvider = context.read<CurrencyProvider>();
await currencyProvider.updateRates();
```

### 5. Biometric Authentication

Implemented using `local_auth` package:

- **Service**: `biometric_service.dart`
- **Screen**: `auth_screen.dart`
- **Fallback**: If not available, skip to home

### 6. Accelerometer (Shake Detection)

Shake detection for quick transaction add:

- **Implementation**: In `home_screen.dart`
- **Threshold**: gForce > 20
- **Cooldown**: 1 second between shakes

## Testing

### Manual Testing Checklist

- [ ] Add income transaction
- [ ] Add expense transaction
- [ ] Edit transaction
- [ ] Delete transaction
- [ ] Add category
- [ ] Edit category
- [ ] Delete category
- [ ] View monthly statistics
- [ ] View yearly statistics
- [ ] Change period in statistics
- [ ] Shake device to add transaction
- [ ] Test biometric authentication
- [ ] Switch between tabs
- [ ] Test with different currencies
- [ ] Test localization (EN/PL)

### Unit Tests (To be implemented)

```bash
# Create test files in test/
test/
├── providers/
│   ├── transaction_provider_test.dart
│   └── category_provider_test.dart
├── services/
│   └── currency_service_test.dart
└── database/
    └── database_test.dart

# Run tests
flutter test
```

## Building for Release

### Android APK

```bash
# Build APK
flutter build apk --release

# Output: build/app/outputs/flutter-apk/app-release.apk
```

### Android App Bundle (for Play Store)

```bash
# Build App Bundle
flutter build appbundle --release

# Output: build/app/outputs/bundle/release/app-release.aab
```

## Common Issues

### Issue: Database schema changes not reflected

**Solution:**
```bash
flutter clean
dart run build_runner clean
dart run build_runner build --delete-conflicting-outputs
flutter run
```

### Issue: Localization strings not found

**Solution:**
```bash
flutter gen-l10n
flutter clean
flutter run
```

### Issue: Biometric not working

**Check:**
- Android: Permission in AndroidManifest.xml
- Device has biometric hardware
- Biometric is enrolled on device

### Issue: API calls failing

**Check:**
- Internet permission in AndroidManifest.xml
- Network connectivity
- API endpoint availability

## Performance Tips

1. **Database Queries**
   - Use indexes on frequently queried columns
   - Implement pagination for large lists
   - Use `watch()` streams instead of polling

2. **State Management**
   - Use `Consumer` with specific providers
   - Avoid rebuilding entire widget tree
   - Use `context.read()` for one-time reads

3. **UI**
   - Use `ListView.builder` for large lists
   - Implement proper loading states
   - Cache images and data when possible

## Code Style

- Follow [Dart Style Guide](https://dart.dev/guides/language/effective-dart/style)
- Use `dart format` before committing
- Run `flutter analyze` to catch issues
- Document public APIs with doc comments

## Git Workflow (if using version control)

```bash
# Feature branch
git checkout -b feature/new-feature

# Make changes, commit
git add .
git commit -m "Add new feature"

# Push and create PR
git push origin feature/new-feature
```

## Resources

- [Flutter Documentation](https://docs.flutter.dev/)
- [Drift Documentation](https://drift.simonbinder.eu/)
- [Provider Documentation](https://pub.dev/packages/provider)
- [Material Design 3](https://m3.material.io/)
